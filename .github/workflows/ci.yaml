# USAGE
# -----
#
# on:
#   workflow_dispatch: {}
#   push:
#     branches:
#       - main
#   pull_request:
#
# jobs:
#   test:
#     uses: alphagov/govuk-infrastructure/.github/workflows/test-rails.yaml@main
#     with:
#       requiresJavaScript: true
#       requiresMongoDB: true
#       requiresRedis: true
#       requiresMySQL: true
#       mysqlUsername: "test"
#       mysqlPassword: "password"


# REUSABLE WORKFLOW
# -----------------
name: CI

on:
  workflow_call:
    inputs:
      extraSystemDependencies:
        description: 'Install additional system dependencies'
        required: false
        default: ''
        type: string

jobs:
  cache-dependencies:
    name: Cache dependencies
    uses: alphagov/govuk-infrastructure/.github/workflows/ci-cache-dependencies.yaml@test-ci

  security-analysis-ruby:
    name: Security Analysis Ruby
    needs: cache-dependencies
    uses: alphagov/govuk-infrastructure/.github/workflows/ci-security-analysis-ruby.yaml@test-ci

  lint-scss:
    name: Lint SCSS
    needs: cache-dependencies
    uses: alphagov/govuk-infrastructure/.github/workflows/ci-lint-scss.yaml@test-ci

  lint-javascript:
    name: Lint JavaScript
    needs: cache-dependencies
    uses: alphagov/govuk-infrastructure/.github/workflows/ci-lint-javascript.yaml@test-ci

  lint-ruby:
    name: Lint Ruby
    needs: cache-dependencies
    uses: alphagov/govuk-infrastructure/.github/workflows/ci-lint-ruby.yaml@test-ci

  test-javascript:
    name: Test JavaScript
    needs: cache-dependencies
    uses: alphagov/govuk-infrastructure/.github/workflows/ci-test-javascript.yaml@test-ci

  test-ruby:
    name: Test Ruby
    needs: cache-dependencies
    uses: alphagov/govuk-infrastructure/.github/workflows/ci-test-ruby.yaml@test-ci
    with:
      extraSystemDependencies: ${{ inputs.extraSystemDependencies }}
